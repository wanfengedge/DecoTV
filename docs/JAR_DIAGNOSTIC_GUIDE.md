# TVBox JAR 源诊断工具使用指南

## 🎯 目的

帮助您诊断和解决 TVBox 配置中的 "spider unreachable: fetch error" 问题。

## 🔧 使用方式

### 方式一：可视化诊断页面（推荐）

访问以下地址，获得友好的图形化诊断界面：

```
https://你的域名/api/tvbox/jar-test
```

**功能**：

- 🎨 精美的可视化界面
- 📊 实时测试进度显示
- 💡 智能诊断建议
- 📈 性能统计图表
- 🔍 详细错误信息

**操作步骤**：

1. 打开上述网址
2. 点击"开始诊断测试"按钮
3. 等待 10-30 秒（会测试所有 JAR 源）
4. 查看详细的诊断报告

### 方式二：JSON API 接口

获取详细的 JSON 格式诊断数据：

```
https://你的域名/api/tvbox/jar-diagnostic
```

**返回数据结构**：

```json
{
  "timestamp": "2025-10-06T...",
  "environment": {
    "isDomestic": true,
    "timezone": "Asia/Shanghai",
    "userAgent": "...",
    "recommendedSources": ["..."]
  },
  "jarTests": [
    {
      "url": "https://...",
      "status": "success",
      "responseTime": 234,
      "fileSize": 123456,
      "httpStatus": 200,
      "isValidJar": true,
      "md5": "abc123..."
    }
  ],
  "summary": {
    "totalTested": 15,
    "successCount": 8,
    "failedCount": 7,
    "averageResponseTime": 456,
    "fastestSource": "https://...",
    "recommendedSource": "https://..."
  },
  "recommendations": [
    "✅ 网络环境良好，多个 JAR 源可用",
    "⚡ 最快源: https://...",
    "..."
  ]
}
```

## 📊 诊断项目说明

### 1. 网络环境检测

- **国内/海外判断**：自动识别您的网络环境
- **时区检测**：通过时区辅助判断地理位置
- **推荐源选择**：根据环境推荐最优 JAR 源顺序

### 2. JAR 源测试

每个 JAR 源都会进行以下测试：

| 测试项        | 说明                            |
| ------------- | ------------------------------- |
| **可达性**    | 测试 HTTP 连接是否成功          |
| **响应时间**  | 测量下载速度（毫秒）            |
| **HTTP 状态** | 检查是否返回 200/404/403 等     |
| **文件大小**  | 验证文件是否过小                |
| **格式验证**  | 检查是否为有效的 JAR（ZIP）文件 |
| **MD5 校验**  | 生成文件指纹用于对比            |

### 3. 状态说明

| 状态        | 图标 | 含义               |
| ----------- | ---- | ------------------ |
| **success** | ✅   | JAR 源完全可用     |
| **failed**  | ❌   | 无法访问或下载失败 |
| **timeout** | ⏱️   | 超时（超过 10 秒） |
| **invalid** | ⚠️   | 文件无效或格式错误 |

## 🔍 常见问题诊断

### 问题 1: 所有源都显示 "failed"

**可能原因**：

- ✗ 网络连接问题
- ✗ 防火墙拦截
- ✗ DNS 解析失败

**解决方案**：

1. 检查本地网络连接
2. 尝试切换 WiFi/移动数据
3. 检查防火墙设置
4. 更换 DNS 服务器

### 问题 2: 部分源 "timeout"

**可能原因**：

- ✗ 网络延迟高
- ✗ 国际网络访问受限
- ✗ 源服务器响应慢

**解决方案**：

1. 使用诊断推荐的最快源
2. 考虑使用代理或 VPN
3. 优先使用国内源

### 问题 3: 显示 "invalid"

**可能原因**：

- ✗ JAR 文件已损坏
- ✗ 源地址失效
- ✗ 文件已被删除

**解决方案**：

1. 这些源已失效，系统会自动跳过
2. 使用诊断推荐的可用源

### 问题 4: HTTP 403/404 错误

**可能原因**：

- ✗ 文件已被移除（404）
- ✗ 访问被拒绝（403）
- ✗ 需要特定的访问权限

**解决方案**：

1. 这些源已不可用
2. 系统会自动切换到其他可用源
3. 关注诊断报告中的可用源

## 💡 使用建议

### 首次使用

1. **运行完整诊断**：访问 `/api/tvbox/jar-test`
2. **记录推荐源**：保存"最快源"地址
3. **测试配置**：在 TVBox 中使用推荐源

### 定期检查

- 建议每周运行一次诊断
- 如遇播放问题，立即运行诊断
- 更新配置前先进行诊断

### 性能优化

- 优先使用"最快源"
- 国内用户选择国内源
- 海外用户选择国际源

## 📋 诊断报告示例

### 理想情况

```
📊 诊断报告
网络环境: 🇨🇳 国内
总测试源: 15
可用源: 12 ✅
失败源: 3
平均响应: 234ms

💡 诊断建议:
✅ 网络环境良好，多个 JAR 源可用
⚡ 最快源: https://gitcode.net/...
🎯 推荐源: https://gitcode.net/...
```

### 需要改善

```
📊 诊断报告
网络环境: 🌐 海外
总测试源: 15
可用源: 3 ⚠️
失败源: 12
平均响应: 1234ms

💡 诊断建议:
⚠️ 只有少数 JAR 源可用，网络环境可能受限
✅ 推荐使用: https://cdn.jsdelivr.net/...
💡 建议使用 VPN 或代理改善网络环境
⏱️ 检测到 8 个超时，网络延迟较高
```

## 🚀 下一步

运行诊断后，请：

1. **截图保存诊断报告**
2. **发送给技术支持**（如需要帮助）
3. **根据建议优化配置**

---

**立即开始诊断**: 访问 `https://你的域名/api/tvbox/jar-test`

有任何问题欢迎反馈！ 🙏
